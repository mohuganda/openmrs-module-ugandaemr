<htmlform formName="HMIS 031 Outpatient (OPD) Form"
          formDescription="HMIS 031 Outpatient (OPD) Form"
          formEncounterType="ee4780f5-b5eb-423b-932f-00b5879df5ab"
          formUuid="8c2f8378-51c7-4407-85a0-cb2832accfcf"
          formVersion="4.0.0"
          formAddMetadata="yes"
          formUILocation="patientDashboard.visitActions"
          formOrder="7"
          formIcon="icon-user"
          formShowIf="(visit.active || !visit.active) &amp;&amp; patient.person.dead==false &amp;&amp; sessionLocation.uuid=='11d5d2b8-0fdd-42e0-9f53-257c760bb9a3'"
          formDisplayStyle="Standard"
          formLabel="Out-Patient(OPD)">

    <style type="text/css">
        table.multi td, table.multi th {
            width: 20% !important;
            border: 1px solid rgb(199, 199, 199) !important;
        }

        table.multi td.duration input {
            min-width: 20% !important;
            width: 25px !important;
            margin-right: 5px;
        }

        table.multi td.duration select {
            min-width: 20% !important;
            width: 50% !important;
            clear: none !important;
        }

        .inError {
            border: 2px dotted #ff0000 !important;
        }

        span.fullwidth input[type=text] {
            width: 100%;
            min-width: 90% !important;
        }

        /**
        Zebra stripping of tables
        */
        form#htmlform div.ai-page-frame table > tbody tr:nth-child(odd) td {
            background: #eeeeee;
        }

        form#htmlform div.ai-page-frame table > tbody tr:nth-child(even) td {
            background: #f9f9f9;
        }

        .card.multi-drug {
            padding: 10px 10px 0 10px;
            background: #eeeeee;
        }
        #medication fieldset input[type=text],  #medication fieldset select {
            max-width: 100% !important;
        }

        #medication fieldset select {
            padding-top: 4px !important;
        }

        .add-remove-style {
            margin-top: 35px;
        }

        #examination fieldset label {
            padding-top: 10px !important;
        }
    </style>

    <script type="text/javascript">
        jQuery(document).ready(function (jq) {
            //Block Multiple encounter entry on same date
            blockEncounterOnSameDateEncounter(jq("#encounterDate").find("input[type=hidden]"), "block");

            jq('#othersCheckBox').on("click", function () {
                if (jq('#othersCheckBox').is(':checked')) {
                    enable_fields("otherSpecify");
                } else {
                    disable_fields("otherSpecify");
                }
            });


            var isOtherSelectedAndSpecified = function () {
                var valid = true;
                var $specifyField = jq(this).siblings('input[type=text]');
                var $errorField = jq(this).siblings('span.error');
                if (jq(this).attr('checked') == 'checked' &amp;&amp; $specifyField.val() == '') {
                    $errorField.html('Please specify').show();
                    $specifyField.addClass('error');
                    valid = false;
                } else {
                    $errorField.html('').hide();
                    $specifyField.removeClass('error');
                }

                return valid;
            };

            /**
             * This validation check works this way:
             * For each visible row, If any text box or combo box is non-empty, check if there's any other text box or combobox within the same row that is empty.
             * If so, validation fails and the elements with missing values are highlighted
             */
            var multipleEntryValidated = function () {
                var $rows,
                    $objectsToValidate;
                var dirty = false;

                $rows = jq('table.multi&gt;tbody tr:visible');
                $rows.each(function () {
                    $objectsToValidate = jq(this).find('input,select'); //Get all text and combo boxes
                    $objectsToValidate.removeClass('inError');
                    $objectsToValidate.each(function () {
                        $obj = jq(this);
                        if ($obj.val() !== '') { //Only run the validatiion check if there's at least one element that is non-empty
                            $objectsToValidate.each(function () {
                                if (jq(this).val() === '') {
                                    jq(this).addClass('inError');
                                    jq(this).siblings('span.error').html('Required').show()
                                    dirty = true;
                                } else {
                                    jq(this).siblings('span.error').html('').hide();
                                }
                            });
                        }
                    });
                });

                return !dirty;
            }

            beforeSubmit.push(function () {
                var valid = true;
                var $errorMessageSpan = jq('span#error-message');

                if (!isOtherSelectedAndSpecified()) {
                    valid = false;
                }

                if (!multipleEntryValidated()) {
                    valid = false;
                }

                //Clear validation messages displayed during a previously failed validation check
                jq("span.error:visible:contains('Required'), span.error:visible:contains('Date without value')").html('').hide();

                if (jq('span.error.field-error:visible').length &gt; 0) {
                    valid = false;
                }

                var noOfErrorsInPrescription=0;
                jq(".multi-drug").each(function () {
                    var id= this.id.replace("-toggleContainer","")
                    var element= jq("#"+id+"-toggleContainer");
                    var qty_unit=jq(element).find("#qty_unit_" + id+" select").find(":selected").val()
                    var duration_unit=jq(element).find("#duration_unit_" + id+" select").find(":selected").val()
                    var drug=jq(element).find("#"+id+"-drug input").val();
                    var qty=jq(element).find("#quantity_" + id).find("input").val()
                    var strength=jq(element).find("#drug_strength_" + id).find("input").val()
                    var duration=jq(element).find("#duration_"+id+" input").val();

                    if(drug!==null &amp;&amp; drug!==""){
                        if(qty_unit===null || qty_unit===""){
                            getField('qty_unit_'+id+".error").html('Qty unit is required').show();
                            noOfErrorsInPrescription+=1
                        }
                        if(duration_unit===null|| duration_unit===""){
                            getField('duration_unit_'+id+".error").html('duration  unit is required').show();
                            noOfErrorsInPrescription+=1
                        }
                        if(qty===null || qty===""){
                            jq('#quantity_' + id).find(".error").html('quantity  is required').show();
                            noOfErrorsInPrescription+=1
                        }

                        if(duration===null || duration===""){
                            jq('#duration_' + id).find(".error").html('duration  is required').show();
                            noOfErrorsInPrescription+=1
                        }

                        if(strength===null || strength===""){
                            jq('#drug_strength_' + id).find(".error").html('strength  is required').show();
                            jq().toastmessage('showErrorToast', "strength for drug "+drug+" is required");
                            noOfErrorsInPrescription+=1
                        }
                    }
                });

                if(noOfErrorsInPrescription>0){
                    jq().toastmessage('showErrorToast', "There are "+noOfErrorsInPrescription+" errors under medication that need to be resolved");
                    valid=false;
                }

                if (valid) {
                    $errorMessageSpan.hide();
                } else {
                    $errorMessageSpan.show();
                    jq().toastmessage('showErrorToast', "Form Validation failed. Check for errors");
                }

                return valid;
            });

        });

        jq(document).ready(function () {
            $allRows = jq(this).find('.visit-diagnosis');
            $allRows.hide();
            jq('#1-removeEntry').remove();
            jq('#10-addEntry').remove();
            jq('#1-toggleDiagnosisContainer').show();

            jq('#11-removeEntry').remove();
            jq('#20-addEntry').remove();
            jq('#11-toggleDiagnosisContainer').show();
        });

        jq(document).ready(function () {
            $allRows = jq(this).find('.multi-drug');
            $allRows.hide();
            jq('#1-removeEntry').remove();
            jq('#10-addEntry').remove();
            jq('#1-toggleContainer').show();

            jq('#11-removeEntry').remove();
            jq('#20-addEntry').remove();
            jq('#11-toggleContainer').show();

        });

        jQuery(document).ready(function (jq) {
            //Adding new form
            var $allTables,
                $allRows,
                $otherRows,
                $firstRow,
                $thisRow,
                $nextRow,
                $hiddenRows,
                $lastVisibleRow,
                $nonEmptyBoxes;

            var showAddButtonForLastVisibleRow = function ($container) {
                $lastVisibleRow = $container.find('tr:visible:last');
                $lastVisibleRow.find('.add').show();
            };

            $firstRow = jq('table.multi tbody tr:first-of-type');
            $otherRows = jq('table.multi tbody tr:not(:first-of-type)');

            <ifMode mode="ENTER">
                disable_fields("otherSpecify");

                $otherRows.hide();
                $firstRow.find('.remove').hide();

                jq(document).ready(function () {
                $allRows = jq(this).find('.multi-drug');
                $allRows.hide();
                jq('#1-removeEntry').remove();
                jq('#10-addEntry').remove();
                jq('#1-toggleContainer').show();

                jq('#11-removeEntry').remove();
                jq('#20-addEntry').remove();
                jq('#11-toggleContainer').show();
            });
            </ifMode>

            <ifMode mode="EDIT">
                //Handle loading of existing obs
                $allTables = jq('table.multi');
                $allTables.each(function() {
                $allRows = jq(this).find('tbody &gt; tr');
                $allRows.hide();
                $nonEmptyBoxes = jq(this).find('input').filter(function() {
                return this.value.length &gt; 0;
            });

                if ($nonEmptyBoxes.length &gt; 0 ) {
                $nonEmptyBoxes.each(function() {
                $thisRow = jq(this).parents('tr:first');
                $thisRow.show();
                if ($thisRow.is($firstRow)) {
                $firstRow.find('.remove').hide();
            }
            });

                if ($nonEmptyBoxes.length == 1) {
                $nonEmptyBoxes.parents('tr:first').find('.remove').hide(); //Hide the remove button if there is only one visible row
            }
            } else {
                $firstRow.show();
                $firstRow.find('.remove').hide();
            }
            });


                jq(document).ready(function () {
                $allRows = jq(this).find('.multi-drug');
                $allRows.hide();
                jq('#1-removeEntry').remove();
                jq('#10-addEntry').remove();
                jq('#1-toggleContainer').show();
                jq('#11-removeEntry').remove();
                jq('#20-addEntry').remove();
                jq('#11-toggleContainer').show();
                for (let x = 0; x&lt;= 10; x++) {
                if (jq(this).find('#' +x+ '-drug').find("input[type$='text']").val()!='') {
                jq(this).find('#' +x+ '-toggleContainer').show();
                jq(this).find('#' +x+ '-addEntry').hide();
            }
                else {
                x-=1;
                jq(this).find('#' +x+ '-addEntry').show();
                break;
            }
            }
            });


                jq(document).ready(function () {
                $allRows = jq(this).find('.visit-diagnosis');
                $allRows.hide();
                jq('#1-removeEntry').remove();
                jq('#10-addEntry').remove();
                jq('#1-toggleDiagnosisContainer').show();
                jq('#11-removeEntry').remove();
                jq('#20-addEntry').remove();
                jq('#11-toggleDiagnosisContainer').show();
                for (let x = 0; x&lt;= 10; x++) {
                if (jq(this).find('#' +x+ '-problem-trigger').find("input[type$='text']").val()!='') {
                jq(this).find('#' +x+ '-toggleDiagnosisContainer').show();
                jq(this).find('#' +x+ '-addEntry').hide();
            }
                else {
                x-=1;
                jq(this).find('#' +x+ '-addEntry').show();
                break;
            }
            }
            });

                if (jq('#otherSpecify').find("input[type$='text']").val()!='') {
                jq('#othersCheckBox').prop("checked", true);
            }
            </ifMode>

            jq('.add').click(function (e) { //Handle add button event
                e.preventDefault();
                $thisRow = jq(this).parents('tr:first');
                $nextRow = $thisRow.next();

                if ($nextRow.length &gt; 0) {
                    $nextRow.show('slow');
                    $thisRow.find('.add').hide();
                }
                showAddButtonForLastVisibleRow($thisRow.parents('table:first'));
            });

            jq('.remove').click(function (e) { //Handle remove button event
                e.preventDefault();
                $thisRow = jq(this).parents('tr:first');
                if (confirm('Are you sure you want to remove this record? All fields for this record will be cleared.') == 1) {
                    $thisRow = jq(this).parents('tr:first');

                    $thisRow.hide('slow', function () {
                        showAddButtonForLastVisibleRow($thisRow.parents('table:first'));
                        fieldHelper.clearAllFields($thisRow);
                    });
                }
            });

            jq(document).ready(function () {
                jq('.addEntry').on("click", function () {
                    var correctedAddButtonId = parseFloat(this.id) + 1;
                    var contentAddId = "#" + correctedAddButtonId + "-toggleContainer";
                    jq(contentAddId).toggle(true);
                    jq('#' + this.id).toggle(false);
                    jq('#' + parseFloat(this.id) + '-removeEntry').toggle(true);
                    return false;
                });
            });

            jq(document).ready(function () {
                jq('.removeEntry').on("click", function () {
                    var correctedRemoveButtonId = parseFloat(this.id) - 1;
                    var contentAddId = "#" + parseFloat(this.id) + "-toggleContainer";
                    jq(contentAddId).toggle(false);
                    jq(':input:not(:button)', contentAddId).val([]);
                    jq('#' + correctedRemoveButtonId + '-addEntry').toggle(true);
                    jq('#' + correctedRemoveButtonId + '-removeEntry').toggle(true);

                    return false;
                });
            });

            // Disallow an entry from being selected twice in the autocomplete multiple entry sections
            jq(".autoCompleteText").on("autocompleteselect", function (event, ui) {

                var $similarSelections = jq(this).parents('table:first').find('input.autoCompleteText:visible[type=text]').filter(function () {
                    return (jq(this).val() == ui.item.label);
                });

                if ($similarSelections.length &gt; 0) {
                    alert('The entry \'' + ui.item.label + '\' has already been selected');
                    return false;
                } else {
                    return true;
                }
            });

        });


        var enableStockManagement = <lookup expression="fn.globalProperty('ugandaemr.enableStockManagement')"/>;
        jq(document).ready(function () {

            currentLocationUUID = getLocationByName(jq("#location_id").find("select").find(":selected").text())
            if (enableStockManagement) {
                jq("#drug_strength_select_1").removeClass("hidden");
                jq("#drug_strength_select_2").removeClass("hidden");
                jq("#drug_strength_select_3").removeClass("hidden");
                jq("#drug_strength_select_4").removeClass("hidden");
                jq("#drug_strength_select_5").removeClass("hidden");
                jq("#drug_strength_select_6").removeClass("hidden");
                jq("#drug_strength_select_7").removeClass("hidden");
                jq("#drug_strength_select_8").removeClass("hidden");
                jq("#drug_strength_select_9").removeClass("hidden");
                jq("#drug_strength_select_10").removeClass("hidden");

            } else {
                jq("#drug_strength_1").removeClass("hidden");
                jq("#drug_strength_2").removeClass("hidden");
                jq("#drug_strength_3").removeClass("hidden");
                jq("#drug_strength_4").removeClass("hidden");
                jq("#drug_strength_5").removeClass("hidden");
                jq("#drug_strength_6").removeClass("hidden");
                jq("#drug_strength_7").removeClass("hidden");
                jq("#drug_strength_8").removeClass("hidden");
                jq("#drug_strength_9").removeClass("hidden");
                jq("#drug_strength_10").removeClass("hidden");
            }

            if (enableStockManagement) {
                jq(".drug_strength").change(function () {
                    var objectPosition = jq(this).attr("id").match(/\d/g)[0]
                    jq('#drug_strength_' + objectPosition + ' input').val(jq(this).find(":selected").attr("strength"))
                    jq('#drug_stock_item_' + objectPosition + ' input').val(jq(this).find(":selected").attr("stockItemUUID"))
                    jq('#drug_dispensing_location_' + objectPosition + ' input').val(jq(this).find(":selected").attr("location"))
                    jq('#drug_' + objectPosition + ' input').val(jq(this).find(":selected").attr("drugUuid"))
                });

                jq("#art-regimen  select").change(function () {
                    getDrugByConcept(jq(this).find(":selected").val(), "drug_strength_art_select")
                });

                jq("#drug_strength_art_select").change(function () {
                    jq(this).parent().find('#drug_strength_art_id input').val(jq(this).find(":selected").attr("strength"))
                    jq(this).parent().find('#drug_stock_item_id input').val(jq(this).find(":selected").attr("stockItemUUID"))
                    jq(this).parent().find('#drug_dispensing_location_id input').val(jq(this).find(":selected").attr("location"))
                    jq(this).parent().find('#drug_id input').val(jq(this).find(":selected").attr("drugUuid"))
                });

                jq("#isoniazid-trigger  input:radio").change(function () {
                    getDrugByConcept(jq(this).val(), "drug_strength_isoniazid_select")
                });

                jq("#drug_strength_isoniazid_select").change(function () {
                    jq(this).parent().find('#drug_strength_isoniazid_id input').val(jq(this).find(":selected").attr("strength"))
                    jq(this).parent().find('#drug_stock_item_id input').val(jq(this).find(":selected").attr("stockItemUUID"))
                    jq(this).parent().find('#drug_dispensing_location_id input').val(jq(this).find(":selected").attr("location"))
                    jq(this).parent().find('#drug_id input').val(jq(this).find(":selected").attr("drugUuid"))
                });

                jq("#vitamin-b6-trigger  input:radio").change(function () {
                    getDrugByConcept(jq(this).val(), "drug_strength_vitamin_b6_select")
                });

                jq("#drug_strength_vitamin_b6_select").change(function () {
                    jq(this).parent().find('#drug_strength_vitamin_b6_id input').val(jq(this).find(":selected").attr("strength"))
                    jq(this).parent().find('#drug_stock_item_vitamin_b6_id input').val(jq(this).find(":selected").attr("stockItemUUID"))
                    jq(this).parent().find('#drug_dispensing_location_vitamin_b6_id input').val(jq(this).find(":selected").attr("location"))
                    jq(this).parent().find('#drug_vitamin_b6_id input').val(jq(this).find(":selected").attr("drugUuid"))
                });

                jq("#fluconazole-trigger  input:radio").change(function () {
                    getDrugByConcept(jq(this).val(), "drug_strength_fluconazole_select")
                });

                jq("#drug_strength_fluconazole_select").change(function () {
                    jq(this).parent().find('#drug_strength_fluconazole_id input').val(jq(this).find(":selected").attr("strength"))
                    jq(this).parent().find('#drug_stock_item_fluconazole_id input').val(jq(this).find(":selected").attr("stockItemUUID"))
                    jq(this).parent().find('#drug_dispensing_location_fluconazole_id input').val(jq(this).find(":selected").attr("location"))
                    jq(this).parent().find('#drug_fluconazole_id input').val(jq(this).find(":selected").attr("drugUuid"))
                });

                jq("#99413-target  input:radio").change(function () {
                    getDrugByConcept(jq(this).val(), "drug_strength_99413_select")
                });

                jq("#drug_strength_99413_select").change(function () {
                    jq(this).parent().find('#drug_strength_99413_id input').val(jq(this).find(":selected").attr("strength"))
                    jq(this).parent().find('#drug_stock_item_99413_id input').val(jq(this).find(":selected").attr("stockItemUUID"))
                    jq(this).parent().find('#drug_dispensing_location_99413_id input').val(jq(this).find(":selected").attr("location"))
                    jq(this).parent().find('#drug_99413_id input').val(jq(this).find(":selected").attr("drugUuid"))
                });

                jq(".drug-other").change(function () {
                    getDrugByConcept(jq(this).find("input:hidden").val(), "drug_strength_select_" + jq(this).attr("id").match(/\d/g)[0] + "")
                });

                jq(".arv-split").change(function () {
                    getDrugByConcept(jq(this).find("input:hidden").val(), jq(this).attr("id").match(/\d/g)[0] + "_arv_split_strength_select")
                });

                jq(".arv_split-strength").change(function () {
                    var objectPosition = jq(this).attr("id").match(/\d/g)[0]
                    jq('#' + objectPosition + '_arv_split_strength input').val(jq(this).find(":selected").attr("strength"))
                    jq('#' + objectPosition + '_arv_split_stock_item input').val(jq(this).find(":selected").attr("stockItemUUID"))
                    jq('#' + objectPosition + '_arv_split_dispensing_location input').val(jq(this).find(":selected").attr("location"))
                    jq('#' + objectPosition + '_arv_split input').val(jq(this).find(":selected").attr("drugUuid"))
                });
            }

        });
        function getDrugByConcept(concept, drug_strength_id) {
            if (enableStockManagement) {
                jq("#" + drug_strength_id + "").find("select").empty();
                var stockItems = []
                jq.ajax({
                    type: "GET",
                    url: '/' + OPENMRS_CONTEXT_PATH + "/ws/rest/v1/stockmanagement/stockiteminventory?v=default&amp;limit=10&amp;totalCount=true&amp;conceptId=" + concept + "&amp;groupBy=LocationStockItem&amp;dispenseLocationUuid=" + currentLocationUUID + "&amp;includeStrength=1&amp;includeConceptRefIds=1",
                    dataType: "json",
                    async: false,
                    success: function (data) {
                        stockItems = data.results;
                    }
                });
                if (stockItems.length) {
                    enable_fields(drug_strength_id)
                }
                jq("#" + drug_strength_id + "").find("select").append($("<option >Select Strength</option>").attr("value", ''));
                for (var i = 0; i &lt; stockItems.length; i++) {
                    jq("#" + drug_strength_id + "").find("select").append($("<option></option>").attr("value", stockItems[i].stockItemUuid).text((stockItems[i].drugName + " | " + stockItems[i].quantity + " " + stockItems[i].quantityUoM + " at " + stockItems[i].partyName).replace("null", " qty ")).attr("location", stockItems[i].locationUuid).attr("strength", stockItems[i].drugStrength).attr("stockItemUUID", stockItems[i].stockItemUuid).attr("drugUuid", stockItems[i].drugUuid));
                }
            }
        }
        function getLocationByName(locationName) {
            var locationUUID
            jq.ajax({
                type: "GET",
                url: '/' + OPENMRS_CONTEXT_PATH + "/ws/rest/v1/location?q=" + locationName,
                dataType: "json",
                async: false,
                success: function (data) {
                    locationUUID = data.results[0].uuid
                }
            });
            return locationUUID
        }
        function getEncountersByEncounterTypeUUID(patientUUID, encounterTypeUUID) {
            var serverResponse = [];
            jq.ajax({
                type: "GET",
                url: '/' + OPENMRS_CONTEXT_PATH + "/ws/rest/v1/encounter?v=full&amp;patient=" + patientUUID + "&amp;encounterType=" + encounterTypeUUID,
                dataType: "json",
                async: false,
                success: function (data) {
                    serverResponse = data.results;
                }
            });
            return serverResponse
        }
    </script>

    <div class="ai-page-frame">
        <div class="headers" style="text-align: center;">
            <h3>HMIS 002 Outpatient (OPD) Form</h3>
        </div>
        <div class="card">
            <div class="card-header">
                <ul class="nav nav-tabs card-header-tabs nav-fill">
                    <li class="nav-item">
                        <a class="nav-link active" data-toggle="tab" href="#patient-vitals">Patient Information /
                            Vitals</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" data-toggle="tab" href="#examination">Examination</a>
                    </li>

                    <li class="nav-item">
                        <a class="nav-link" data-toggle="tab" href="#diagnosis">Diagnosis</a>
                    </li>
                    
                    <li class="nav-item">
                        <a class="nav-link" data-toggle="tab" href="#investigation">Investigations Results</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" data-toggle="tab" href="#medication">Medication</a>
                    </li>
                </ul>
            </div>
        </div>
        <div class="card-body">
            <div class="tab-content">
                <div class="tab-pane active" id="patient-vitals">
                    <fieldset>
                        <table width="100%" border="0" cellspacing="0" cellpadding="0">
                            <tr>
                                <td>
                                    <p id="encounter-date">
                                        <label>
                                            <span class="required">*</span>Visit date:
                                        </label>
                                        <encounterDate default="today" disallowMultipleEncountersOnDate="block"/>
                                        <span class="hidden">

										<encounterLocation id="location_id"
                                                           default="SessionAttribute:emrContext.sessionLocationId"/>
										<encounterProviderAndRole encounterRole="240b26f9-dd88-4172-823d-4a8bfeb7841f"
                                                                  required="required" default="currentUser"/>
									</span>
                                    </p>
                                </td>
                                <td></td>
                            </tr>
                        </table>
                    </fieldset>

                    <fieldset>
                        <legend>Vitals</legend>
                        <uiInclude provider="ugandaemr" fragment="vitals"/>
                    </fieldset>
                </div>
                <div class="tab-pane" id="examination">
                    <div class="card">
                        <div class="card-header">Examination</div>
                        <div class="card-body">
                            <obsgroup groupingConceptId="657">
                                <div class="row">
                                    <div class="col-4 lablex2">
                                        <label style="width: 100%; background-color: #e5e2e2">HEENT</label>
                                        <br/>
                                        <repeat with="['861','HEARING DIFFICULTIES'],['873','OTORRHEA'],['873','EAR DISCHARGE'],['5244','ORAL SORES'],['5334','CANDIDIASIS',' ORAL'],['5334','THRUSH'],['5953','VISION DIFFICULTIES'],['5954','SWALLOWING DIFFICULTIES'],['6016','NASAL DISCHARGE']">
                                            <obs id="{0}" conceptId="1070" answerConceptId="{0}" answerLabel="{1}" style="checkbox"/>
                                        </repeat>
                                    </div>
                                    <div class="col-4 lablex2">
                                        <label style="width: 100%; background-color: #e5e2e2">Cardiopulmonary/Resipitory</label>
                                        <br/>
                                        <repeat with="['58','TUBERCULOSIS'],['107','COUGH'],['136','CHEST PAIN'],['801','TACHYPNEA'],['801','FAST BREATHING'],['1145','HISTORY OF PNEUMONIA'],['5957','PRODUCTIVE COUGH'],['5960','SHORTNESS OF BREATH'],['5961','SHORTNESS OF BREATH AT REST'],['5963','SHORTNESS OF BREATH WITH EXERTION']">
                                            <obs id="{0}" conceptId="1071" answerConceptId="{0}" answerLabel="{1}" style="checkbox"/>
                                        </repeat>
                                    </div>

                                    <div class="col-4 lablex2">
                                        <label style="width: 100%; background-color: #e5e2e2">GASTROINTESTINAL</label>
                                        <br/>
                                        <repeat with="['16','DIARRHOEA'],['151','ABDOMINAL PAIN'],['5978','NAUSEA'],['5980','VOMITING'],['5986','HISTORY OF JAUNDICE'],['6017','REFUSAL TO FEED'],['6019','ABDOMINAL SWELLING'],['6031','POOR APPETITE'],['6032','HEPATIC DISEASE']">
                                            <obs id="{0}" conceptId="1078" answerConceptId="{0}" answerLabel="{1}" style="checkbox"/>
                                        </repeat>
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col-4 lablex2">
                                        <label style="width: 100%; background-color: #e5e2e2">GENITOURINARY</label>
                                        <br/>
                                        <repeat with="['55','URINARY TRACT INFECTION'],['840','HEMATURIA'],['840','Hematuria'],['840','BLOODY URINE'],['5989','MENSTRUATING'],['5990','MENOPAUSAL'],['5993','VAGINAL DISCHARGE'],['5995','URETHRAL DISCHARGE'],['6020','DYSURIA'],['6021','OLIGURIA'],['6033','RENAL DISEASE']">
                                            <obs id="{0}" conceptId="1080" answerConceptId="{0}" answerLabel="{1}" style="checkbox"/>
                                        </repeat>
                                    </div>


                                    <div class="col-4 lablex2">
                                        <label style="width: 100%; background-color: #e5e2e2">MUSCULOSKELETAL</label>
                                        <br/>
                                        <repeat with="['80','JOINT PAIN'],['590','EDEMA, LEGS'],['590','LEG SWELLING'],['5312','JOINT SWELLING'],['6034','MUSCLE PAIN'],['6035','PAIN LOWER EXTREMITIES']">
                                            <obs id="{0}" conceptId="1081" answerConceptId="{0}" answerLabel="{1}" style="checkbox"/>
                                        </repeat>
                                    </div>

                                    <div class="col-4 lablex2">
                                        <label style="width: 100%; background-color: #e5e2e2">CENTRAL NERVOUS SYSTEM</label>
                                        <br/>
                                        <repeat with="['77','MENTAL DISORDERS'],['206','SEIZURE'],['207','DEPRESSION'],['620','HEADACHE'],['6004','PARESTHESIA'],['6005','FOCAL WEAKNESS'],['6006','CONFUSION'],['6037','MEMORY PROBLEMS']">
                                            <obs id="{0}" conceptId="1082" answerConceptId="{0}" answerLabel="{1}" style="checkbox"/>
                                        </repeat>
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col-4 lablex2">
                                        <label style="width: 100%; background-color: #e5e2e2">DEVELOPMENTAL</label>
                                        <br/>
                                        <repeat with="['5550','LEARNING PROBLEMS '],['6022','DELAYED MILESTONES '],['6025','REGRESSED MILESTONES '],['6037','MEMORY PROBLEMS']">
                                            <obs id="{0}" conceptId="1189" answerConceptId="{0}" answerLabel="{1}" style="checkbox"/>
                                        </repeat>
                                    </div>

                                    <div class="col-4 lablex2">
                                        <label style="width: 100%; background-color: #e5e2e2">Obstetrical/Pregnancy</label>
                                        <br/>
                                        <repeat with="['1452','No fetal movements'],['1452','No foetal movements'] ,['113377','Decreased fetal movements'] ,['113377','Decreased foetal movements'],['118246','Poor Fetal Growth'],['118256','Fetal Distress'],['147232','Vaginal bleeding'],['148989','Amenorrhea']">
                                            <obs id="{0}" conceptId="159614" answerConceptId="{0}" answerLabel="{1}" style="checkbox"/>
                                        </repeat>
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col-4" id="trigger">
                                        <obs id="enable-disable-signs-and-symptoms" conceptId="90251" answerConceptId="90002" answerLabel="Other specify"/>
                                    </div>
                                    <div class="col-4" id="disabled">
                                        <obs id="signs-and-symptoms-enabled" conceptId="99032" size="17"/>
                                    </div>
                                    <div class="col-4">

                                    </div>
                                </div>
                            </obsgroup>
                        </div>
                    </div>
                </div>
                <div class="tab-pane" id="diagnosis">
                    <div class="card" >
                        <div class="card-header">Diagnosis</div>
                        <div class="card-body">
                            <div class="card-body">
                                <div>
                                    <repeat>
                                        <template>
                                            <obsgroup groupingConceptId="159947">
                                                <div class="row visit-diagnosis" id="{id}-toggleDiagnosisContainer">
                                                    <div class="col-md-3">
                                                        <obs id="{id}-problem-trigger" labelText="Diagnosis" conceptId="1284" answerClasses="Diagnosis" style="autocomplete" class="fullwidth diagnosis-problem"/>
                                                        <obs class="hidden" id="{id}-problem-other" conceptId="161602" labelText="Specify Diagnosis"/>
                                                    </div>
                                                    <div class="col-md-2 diagnosis-certainty" id="{id}-certainty">
                                                        <obs conceptId="159394" labelText="Certainty"/>
                                                    </div>

                                                    <div class="col-md-2 diagnosis-order" id="{id}-order">
                                                        <obs conceptId="159946" labelText="Precedence"/>
                                                    </div>

                                                    <div class="col-md-2 diagnosis-severity" id="{id}-severity">
                                                        <obs conceptId="162820" labelText="Severity"/>
                                                    </div>

                                                    <div class="col-md-2">
                                                        <div class="addEntry">
                                                            <a href="#" id="{id}-diagnosis-addEntry"
                                                               class="addEntry add-more-link"><i
                                                                    class="icon-plus-sign"></i></a>
                                                            <a href="#"
                                                               class="removeEntry remove-more-link"
                                                               id="{id}-diagnosis-removeEntry"><i
                                                                    class="icon-minus"></i></a>
                                                        </div>
                                                    </div>
                                                </div>
                                            </obsgroup>
                                        </template>
                                        <render id="1"/>
                                        <render id="2"/>
                                        <render id="3"/>
                                        <render id="4"/>
                                        <render id="5"/>
                                        <render id="6"/>
                                        <render id="7"/>
                                        <render id="8"/>
                                        <render id="9"/>
                                        <render id="10"/>
                                    </repeat>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="card" id="clinical-notes">
                        <div class="card-header">Clinical Notes</div>
                        <div class="card-body">
                            <obs conceptId="159395" rows="6" cols="90"/>
                        </div>
                    </div>
                </div>
                <div class="tab-pane" id="investigation">
                    <div class="card" >
                        <div class="card-header">Laboratory Tests</div>
                        <div class="card-body">
                            <div class="card-body">
                                <div class="row investigations">
                                    <repeat with="['165418','CrAg'],['165417','RPR'],['165416','TB LAM'],['165413','GeneXpert'],['165415','Microscopy'],['1019','CBC'],['657','Cd4'],['165412','VL'],['1643','Malaria RDT'],['302','URINALYSIS'],['166522','LFT'],['166529','RFT'],['953','LIVER FUNCTION TESTS'],['1010','LIPID Panel'],['1026','DIFFERENTIAL'],['5473','SERUM ELECTROLYTES'],['99145','BASELINE CD4 PERCENTAGE'],['159645','CSF Examination'],['159981','TB Culture Construct'],['161152','Prothrombin Time (with INR)'],['161199','Cytology'],['161422','HBG With Electrophoresis'],['161424','RBC Morphology Test'],['161425','Sedimentation Test'],['161426','Malarial Parasites Smear'],['161428','Microfilaria Test'],['161429','Hemoglobin Only'],['161430','Routine Blood Panel'],['161431','Sickling Test Only'],['161432','Absolute Eosinophil Count Test'],['161434','Bleeding Time Test'],['161436','Clotting Time Test'],['161437','Anemia Panel'],['161446','Routine Urine'],['161451','Stool Analysis'],['161458','Vaginal Swab'],['161461','Ziehl-Neelsen Stain Test'],['161463','Skin Fungal Test'],['161464','Skin Mycobacterial Test'],['161468','Semen Analysis Test'],['161473','Blood Grouping Test'],['1325','Hepatitis C Serological Test'],['161475','Hepatitis B Serological Test'],['161476','Syphilis serological Panel'],['161477','Typhoid serological Test'],['161478','Anti-Streptolysin O Test'],['161479','Rheumatoid Factor Test'],['161480','HIV Serological Test'],['161483','Serum Chemistry Panel'],['161486','Culture Panel'],['161487','Diabetes Panel'],['161488','Renal Function Panel'],['161491','FSH Panel'],['161492','Leutinizing Hormone Panel'],['161493','Alpha Fetoprotein Test'],['161495','ANA'],['161496','Bone Marrow Test'],['161497','Cancer Marker Panel'],['161498','CPK Measurement'],['161499','Coombs Test'],['161501','C-reactive Protein Test'],['161506','Thyroid Panel'],['161508','Ceruloplasmin Test'],['168064','HCG'],['161510','Carcinoembryonic Antigen'],['161512','Serum Iron Profile'],['161514','G6PD'],['161515','Lipase Test'],['161517','Prolactin Test'],['161518','Cardiac Enzyme Test'],['161520','PSA Test'],['161532','TORCH Panel'],['161533','TORCHS Panel'],['162630','Basic Metabolic Panel'],['163436','Coagulation Profile'],['163602','Arterial Blood Gas Panel'],['163625','Toxoplasma Panel'],['163628','VTC Panel'],['163631','Tuberculin skin test Panel'],['163652','Urethral fluid examination Panel'],['163679','Bacterial culture Panel'],['163697','Urine microscopy Panel'],['163700','CBC (auto)'],['163701','CBC With Manual Differential'],['163702','Clotting Panel'],['163708','GTT  (75g)'],['165419','Malaria Test'],['165824','HIVDR'],['166284','Covid test type'],['166405','Blood gas done'],['166429','ALT/SGOT'],['167178','PPG'],['163342','HIV p24 antigen'],['163610','HIV drug-resistance'],['163722','Rapid test for HIV'],['167441','HIV PCR, DBS']">
                                        <div class="col-3">
                                            <obs id="{0}" conceptId="1271"
                                                 answerConceptId="{0}"
                                                 answerLabel="{1}" style="checkbox"/>
                                        </div>
                                    </repeat>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="card" >
                        <div class="card-header">Laboratory Results</div>
                        <div class="card-body">
                            <div class="card-body">
                                <uiInclude provider="ugandaemr" fragment="displayResultListOnEncounter"/>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="tab-pane" id="medication">
                    <fieldset>
                        <legend>Drugs / Treatment</legend>
                        <repeat>
                            <template>
                                <obsgroup groupingConceptId="160741">
                                    <div class="row multi-drug" id="{id}-toggleContainer">
                                        <div class="col-md-3">
                                            <obs id="{id}-drug"
                                                 labelText="Drug" conceptId="1282"
                                                 answerClasses="Drug" style="autocomplete"
                                                 class="fullwidth drug-other"/>
                                        </div>
                                        <div class="col-md-3 drug_strength hidden"
                                             id="drug_strength_select_{id}">
                                            <label>Strength | Stock Qty</label>
                                            <select class="form-control"
                                                    name="drug_strength_select_{id}"
                                                    onselect="this">
                                                <option value="">Select Strength</option>
                                            </select>
                                        </div>

                                        <div class="col-md-3 drug_strength hidden" id="drug_strength_{id}">
                                            <obs class="drug-strength" conceptId="1444"
                                                 labelText="Strength"/>
                                        </div>
                                        <div class="hidden">
                                            <obs id="drug_stock_item_{id}"
                                                 conceptId="166969"
                                                 labelText="Stock Item Id"/>
                                            <obs id="drug_dispensing_location_{id}"
                                                 conceptId="166968"
                                                 labelText="dispensing Location ID"/>
                                            <obs id="drug_{id}" conceptId="166970"
                                                 labelText="Drug ID"/>
                                        </div>
                                        <div class="col-md-3" id="quantity_{id}">
                                            <obs id="other-meds-quantity"
                                                 labelText="Quantity" conceptId="160856"/>
                                        </div>
                                        <div class="col-md-3">
                                            <obs labelText="Qty unit" conceptId="165791"
                                                 id="qty_unit_{id}"
                                                 answerConceptSetIds="162402,162384"/>
                                        </div>
                                        <div class="col-md-3 duration">
                                            <label>Duration</label>
                                            <obs id="duration_{id}" conceptId="159368"/>
                                        </div>
                                        <div class="col-md-3">
                                            <obs conceptId="1732" id="duration_unit_{id}"
                                                 labelText="Duration unit"/>
                                        </div>
                                        <div class="col-md-3">
                                            <obs conceptId="160855"
                                                 labelText="Frequency"/>
                                        </div>
                                        <div class="col-md-6">
                                            <obs conceptId="175387"
                                                 labelText="Dose Instruction"  rows="2" cols="90"/>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="add-entry">
                                                <a href="#" id="{id}-addEntry"
                                                   class="addEntry add-more-link"><i
                                                        class="icon-plus-sign"></i></a>
                                                <a href="#"
                                                   class="removeEntry remove-more-link"
                                                   id="{id}-removeEntry"><i
                                                        class="icon-minus"></i></a>
                                            </div>
                                        </div>
                                    </div>
                                </obsgroup>
                            </template>
                            <render id="1"/>
                            <render id="2"/>
                            <render id="3"/>
                            <render id="4"/>
                            <render id="5"/>
                            <render id="6"/>
                            <render id="7"/>
                            <render id="8"/>
                            <render id="9"/>
                            <render id="10"/>
                        </repeat>
                    </fieldset>
                </div>
            </div>
        </div>
        <section>
            <postSubmissionAction class="org.openmrs.module.ugandaemr.htmlformentry.OPDFormSubmissionAction"/>
            <submit submitLabel="Save"/>
            <span style="clear:none;float:none;margin:5px;display: none;border: 2px dotted #fb0303;color: #fb0303;"
                  id="error-message">
        You have errors in your form, please scroll up to see them.
      </span>
        </section>
    </div>
</htmlform>
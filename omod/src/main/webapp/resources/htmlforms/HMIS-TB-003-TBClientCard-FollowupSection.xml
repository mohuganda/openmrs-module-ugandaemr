<htmlform 
    formName="DS TB: HMIS TB 003 - TB Client Card Followup Section" 
    formDescription="TB Encounter" 
    formEncounterType="455bad1f-5e97-4ee9-9558-ff1df8808732" 
    formUuid="0248cd00-bc53-11ea-b3de-0242ac130004" 
    formVersion="4.0.0"
    formAddMetadata="yes" 
    formUILocation="patientDashboard.visitActions" 
    formOrder="2" 
    formIcon="icon-medkit" 
    formShowIf="(visit.active || !visit.active) &amp;&amp; patient.person.dead==false &amp;&amp; sessionLocation.uuid=='8ab22b55-9a17-4121-bf08-6134a9a2439f'" 
    formDisplayStyle="Standard" 
    formLabel="DS TB: HMIS TB 003 - TB CLIENT CARD FoLLOWUP SECTION"> 

	<script type="text/javascript">
		if (jQuery) {

		    jq(document).ready(function () {

                var visitDate        = '<lookup expression="visit.startDatetime"/>';
                var patientUUID      = '<lookup complexExpression="$patient.uuid"/>';
                var serverResponse   = [];
                var messageNotInTbProgram="This Patient is not in an active TB Program. Enroll them by creating a DS TB Treatment Program. You will be redirected to the patient Dashboard";
                var messageWrongTBInfection="This Patient an active Drug Resistant TB Case. You can only enter DR TB Encounters. You will be redirected to the patient Dashboard";
                var tbInfectionTypeUUID="aa7135e4-92f6-453e-bfea-923e08ec7052";

                jq.ajax({
                    type: "GET",
                    url: '/' + OPENMRS_CONTEXT_PATH + "/ws/rest/v1/programenrollment?v=full&amp;patient=" + patientUUID,
                    dataType: "json",
                    async: false,
                    success: function (data) {
                        serverResponse = data.results;
                    }
                });

                <!--var currentTBProgram = getCurrentTBProgramOrBlockEncounter(patientUUID, visitDate, serverResponse, tbInfectionTypeUUID, messageNotInTbProgram, messageWrongTBInfection);-->

                //Block multiple encounter entries on the same date
                blockEncounterOnSameDateEncounter(jq("#encounterDate").find("input[type=hidden]"),"block");


                //Validate MUAC
                var age  = <lookup complexExpression="$patient.age" />; 
                getMUACCodeFromMUACScoreByAge(age, "muac-score", "muac-code");

                var calculateBmi = function (wt, ht) {
                var bmi = null
                    if (wt &amp;&amp; ht) {
                        bmi = wt / ((ht / 100) * (ht / 100));
                    }
                    return bmi;
                }

                <ifMode mode = "ENTER" >

                    //functions to handle updating the bmi when in ENTER mode
                    var updateBmi = function () {
                        var wt = htmlForm.getValueIfLegal('weight.value');
                        var ht = htmlForm.getValueIfLegal('height.value');

                        var bmi = calculateBmi(wt, ht);

                        if (bmi == null || isNaN(bmi)) {
                            jq('#calculated-bmi-wrapper').hide();
                        } else {
                            jq('#no-calculated-bmi').hide();
                            jq('#calculated-bmi-wrapper').show();
                            jq('#calculated-bmi').html(bmi.toFixed(1));
                            jq('#hidden-calculated-bmi').val(bmi.toFixed(1));
                        }
                    };

                    jq(function () {
                        jq('#calculated-bmi-wrapper').hide();
                        getField('weight.value').change(updateBmi)
                        getField('height.value').change(updateBmi);
                        updateBmi();
                    });

                </ifMode>

                <ifMode mode = "VIEW" >
                    // handle displaying the bmi when in VIEW mode
                    // we have to iterate through in case there are multiple vitals forms
                    // displayed on a single page

                    jq('htmlform').each(function (index, form) {
                        jq(form).find('#calculated-bmi-continue').hide();
                        jq(form).find('#no-calculated-bmi').hide();

                        var wt = jq(form).find('#weight').find('.value').text();
                        var ht = jq(form).find('#height').find('.value').text();

                        var bmi = calculateBmi(wt, ht);

                        if (bmi != null &amp;&amp; !isNaN(bmi)) {
                            jq(form).find('#calculated-bmi-wrapper').show();
                            jq(form).find('#calculated-bmi').html(bmi.toFixed(1));
                            jq(form).find('#hidden-calculated-bmi').val(bmi.toFixed(1));
                        }
                    });
                </ifMode>

				//change results for a selected test
                jq("#165844_1").change(function () {

                    if(jq(this).find("select").find(":selected").val() == "90225") {
                        jq("#smear-results_1").removeClass('hidden'); 
                    } else {
                        jq("#smear-results_1").addClass('hidden');
                    }

                    if(jq(this).find("select").find(":selected").val() == "165413") {
                        jq("#geneexper-results_1").removeClass('hidden'); 
                    } else {
                        jq("#geneexper-results_1").addClass('hidden');
                    }

                     if(jq(this).find("select").find(":selected").val() == "165416") {
                        jq("#tblam-results_1").removeClass('hidden'); 
                    } else {
                        jq("#tblam-results_1").addClass('hidden');
                    }

                    if(jq(this).find("select").find(":selected").val() == "12") {
                        jq("#xray-results_1").removeClass('hidden'); 
                    } else {
                        jq("#xray-results_1").addClass('hidden');
                    }
                });

                jq("#165844_2").change(function () {

                    if(jq(this).find("select").find(":selected").val() == "90225") {
                        jq("#smear-results_2").removeClass('hidden'); 
                    } else {
                        jq("#smear-results_2").addClass('hidden');
                    }

                    if(jq(this).find("select").find(":selected").val() == "165413") {
                        jq("#geneexper-results_2").removeClass('hidden'); 
                    } else {
                        jq("#geneexper-results_2").addClass('hidden');
                    }

                     if(jq(this).find("select").find(":selected").val() == "165416") {
                        jq("#tblam-results_2").removeClass('hidden'); 
                    } else {
                        jq("#tblam-results_2").addClass('hidden');
                    }

                    if(jq(this).find("select").find(":selected").val() == "12") {
                        jq("#xray-results_2").removeClass('hidden'); 
                    } else {
                        jq("#xray-results_2").addClass('hidden');
                    }
                });

                jq("#165844_3").change(function () {

                    if(jq(this).find("select").find(":selected").val() == "90225") {
                        jq("#smear-results_3").removeClass('hidden'); 
                    } else {
                        jq("#smear-results_3").addClass('hidden');
                    }

                    if(jq(this).find("select").find(":selected").val() == "165413") {
                        jq("#geneexper-results_3").removeClass('hidden'); 
                    } else {
                        jq("#geneexper-results_3").addClass('hidden');
                    }

                     if(jq(this).find("select").find(":selected").val() == "165416") {
                        jq("#tblam-results_3").removeClass('hidden'); 
                    } else {
                        jq("#tblam-results_3").addClass('hidden');
                    }

                    if(jq(this).find("select").find(":selected").val() == "12") {
                        jq("#xray-results_3").removeClass('hidden'); 
                    } else {
                        jq("#xray-results_3").addClass('hidden');
                    }
                });

                jq("#165844_4").change(function () {

                    if(jq(this).find("select").find(":selected").val() == "90225") {
                        jq("#smear-results_4").removeClass('hidden'); 
                    } else {
                        jq("#smear-results_4").addClass('hidden');
                    }

                    if(jq(this).find("select").find(":selected").val() == "165413") {
                        jq("#geneexper-results_4").removeClass('hidden'); 
                    } else {
                        jq("#geneexper-results_4").addClass('hidden');
                    }

                     if(jq(this).find("select").find(":selected").val() == "165416") {
                        jq("#tblam-results_4").removeClass('hidden'); 
                    } else {
                        jq("#tblam-results_4").addClass('hidden');
                    }

                    if(jq(this).find("select").find(":selected").val() == "12") {
                        jq("#xray-results_4").removeClass('hidden'); 
                    } else {
                        jq("#xray-results_4").addClass('hidden');
                    }
                });

                jq("#165844_5").change(function () {

                    if(jq(this).find("select").find(":selected").val() == "90225") {
                        jq("#smear-results_5").removeClass('hidden'); 
                    } else {
                        jq("#smear-results_5").addClass('hidden');
                    }

                    if(jq(this).find("select").find(":selected").val() == "165413") {
                        jq("#geneexper-results_5").removeClass('hidden'); 
                    } else {
                        jq("#geneexper-results_5").addClass('hidden');
                    }

                     if(jq(this).find("select").find(":selected").val() == "165416") {
                        jq("#tblam-results_5").removeClass('hidden'); 
                    } else {
                        jq("#tblam-results_5").addClass('hidden');
                    }

                    if(jq(this).find("select").find(":selected").val() == "12") {
                        jq("#xray-results_5").removeClass('hidden'); 
                    } else {
                        jq("#xray-results_5").addClass('hidden');
                    }
                });

                <ifMode mode = "ENTER" >
                    //disable outcome fields
                    disable_fields("90211");  //health facility
                    disable_fields("165853"); //District
                    disable_fields("159635"); //Phone Contact of receiving Health Unit
                    disable_fields("99413");  //CPT/Dapson
                    disable_fields("165871"); // ARV drugs
                    disable_fields("159368"); // number of days
                    disable_fields("160856"); // number of drugs

                    disable_fields("165844_1"); //test
                    disable_fields("165844_2");
                    disable_fields("165844_3");
                    disable_fields("165844_4");
                    disable_fields("165844_5");

                    disable_fields("165845_1"); //lab number
                    disable_fields("165845_2");
                    disable_fields("165845_3");
                    disable_fields("165845_4");
                    disable_fields("165845_5");
                    disable_fields("165872");   //outcome date

                    disable_fields("165854"); //health facility name

                </ifMode>

                //enable district if health facility is provided/entered
                jq("#90211").change(function () {
                    if (jq(this).find("input").val() !== " ") {
                        enable_fields("165853"); 
                    } else {
                        disable_fields("165853");
                    }
                });

                //enable Phone Contact of receiving Health Unit if district is provided/entered
                jq("#165853").change(function () {
                    if (jq(this).find("input").val() !== " ") {
                        enable_fields("159635"); 
                    } else {
                        disable_fields("159635");
                    }
                });


                var artInitiationDate = "<lookup expression="fn.latestObs('99161').valueDatetime"/>";
                if(artInitiationDate != '' || artInitiationDate != null || artInitiationDate != NULL || typeof artInitiationDate != "undefined") {
                    //HIV Status
                    disable_fields("165396");
                    jq("#165396").find("select").val("165350");
                }

                //enable ctx/Dapson/ARV drugs
                jq("#165396").change(function () {
                    var $hivStatus = jq(this).find("select").find(":selected").val();
                    if($hivStatus == "165397" || $hivStatus == "165350") {
                        enable_fields("99413");
                        enable_fields("165871");
                    } else {
                        disable_fields("99413");
                        disable_fields("165871");
                    }
                });

                //enable number of pills and number of days
                jq("#99374").change(function () {
                    if(jq(this).find("select").find(":selected").val() !== "") {
                        enable_fields("159368");
                        enable_fields("160856");
                    } else {
                        disable_fields("159368");
                        disable_fields("160856");
                    }
                });

                //enable test and lab number if text date is provided
                jq('#164431_1').change(function () {
                    if(jq(this).find("input[type$='text']").val()!= "") {
                        enable_fields("165844_1");
                        enable_fields("165845_1");
                    } else {
                        disable_fields("165844_1");
                        disable_fields("165845_1");
                    }
                });

                jq('#164431_2').change(function () {
                    if(jq(this).find("input[type$='text']").val()!= "") {
                        enable_fields("165844_2");
                        enable_fields("165845_2");
                    } else {
                        disable_fields("165844_2");
                        disable_fields("165845_2");
                    }
                });

                jq('#164431_3').change(function () {
                    if(jq(this).find("input[type$='text']").val()!= "") {
                        enable_fields("165844_3");
                        enable_fields("165845_3");
                    } else {
                        disable_fields("165844_3");
                        disable_fields("165845_3");
                    }
                });

                jq('#164431_4').change(function () {
                    if(jq(this).find("input[type$='text']").val()!= "") {
                        enable_fields("165844_4");
                        enable_fields("165845_4");
                    } else {
                        disable_fields("165844_4");
                        disable_fields("165845_4");
                    }
                });

                jq('#164431_5').change(function () {
                    if(jq(this).find("input[type$='text']").val()!= "") {
                        enable_fields("165844_5");
                        enable_fields("165845_5");
                    } else {
                        disable_fields("165844_5");
                        disable_fields("165845_5");
                    }
                });

                //enable other test and other results
                jq("#165844_1").change(function () {
                    if(jq(this).find("select").find(":selected").val() == "90002") {
                        jq("#other-test-div_1").removeClass('hidden');
                        jq("#other-results-div_1").removeClass('hidden');
                        jq("#results-div_1").addClass('hidden');
                    } else {
                        jq("#other-test-div_1").addClass('hidden');
                        jq("#other-results-div_1").addClass('hidden');
                        jq("#results-div_1").removeClass('hidden');
                    }
                });

                jq("#165844_2").change(function () {
                    if(jq(this).find("select").find(":selected").val() == "90002") {
                        jq("#other-test-div_2").removeClass('hidden');
                        jq("#other-results-div_2").removeClass('hidden');
                        jq("#results-div_2").addClass('hidden');
                    } else {
                        jq("#other-test-div_2").addClass('hidden');
                        jq("#other-results-div_2").addClass('hidden');
                        jq("#results-div_2").removeClass('hidden');
                    }
                });

                jq("#165844_3").change(function () {
                    if(jq(this).find("select").find(":selected").val() == "90002") {
                        jq("#other-test-div_3").removeClass('hidden');
                        jq("#other-results-div_3").removeClass('hidden');
                        jq("#results-div_3").addClass('hidden');
                    } else {
                        jq("#other-test-div_3").addClass('hidden');
                        jq("#other-results-div_3").addClass('hidden');
                        jq("#results-div_3").removeClass('hidden');
                    }
                });

                jq("#165844_4").change(function () {
                    if(jq(this).find("select").find(":selected").val() == "90002") {
                        jq("#other-test-div_4").removeClass('hidden');
                        jq("#other-results-div_4").removeClass('hidden');
                        jq("#results-div_4").addClass('hidden');
                    } else {
                        jq("#other-test-div_4").addClass('hidden');
                        jq("#other-results-div_4").addClass('hidden');
                        jq("#results-div_4").removeClass('hidden');
                    }
                });

                jq("#165844_5").change(function () {
                    if(jq(this).find("select").find(":selected").val() == "90002") {
                        jq("#other-test-div_5").removeClass('hidden');
                        jq("#other-results-div_5").removeClass('hidden');
                        jq("#results-div_5").addClass('hidden');
                    } else {
                        jq("#other-test-div_5").addClass('hidden');
                        jq("#other-results-div_5").addClass('hidden');
                        jq("#results-div_5").removeClass('hidden');
                    }
                });

                //enable outcome date if outcome is provided
                jq("#99423").change(function () {
                    if(jq(this).find("select").find(":selected").val() != "") {
                        enable_fields("165872");
                    } else {
                        disable_fields("165872");
                    }
                });

                //enable transfer date if the outcome is transfered out
                jq("#99423").change(function () {
                    if(jq(this).find("select").find(":selected").val() == "90306") { 
                        enable_fields("165854");
                    } else {
                        disable_fields("165854");
                    }
                });

                //enable health facility name if transfer date is provided
                jq("#165854").change(function () {
                    if(jq(this).find("input[type$='text']").val()!= "") {
                        enable_fields("90211");
                    } else {
                        disable_fields("90211");
                    }
                });

                <!-- Add/remove tests and results-->
                var $otherRows,
                    $firstRow,
                    $thisRow,
                    $nextRow,
                    $lastVisibleRow;
                var showAddButtonForLastVisibleRow = function($container) {
                    $lastVisibleRow = $container.find('span.add-remove-section:visible:last');
                    $lastVisibleRow.find('.add').show();
                };

                $firstRow = jq('span.add-remove-section:first-of-type');
                $otherRows = jq('span.add-remove-section:not(:first-of-type)');

                jq('.add').click(function(e) { //Handle add button event
                    e.preventDefault();
                    $thisRow = jq(this).parents('span.add-remove-section:first');
                    $nextRow = $thisRow.next();

                    if ($nextRow.length &gt; 0) {
                        $nextRow.show('slow');
                        $thisRow.find('.add').hide();
                    }
                });

                jq('.remove').click(function(e) { //Handle remove button event
                    e.preventDefault();
                    $thisRow = jq(this).parents('span.add-remove-section:first');
                    if (confirm('Are you sure you want to remove this record? All fields for this record will be cleared.') == 1) {
                        $thisRow = jq(this).parents('span.add-remove-section:first');
                        $lastRow = jq(this).parents('span.add-remove-section:last');
                        $lastVisibleRow = $lastRow.prev();

                        $thisRow.hide('slow', function() {
                            fieldHelper.clearAllFields($thisRow);
                            $lastVisibleRow.find('.add').show();
                        });
                    }
                });
               
                $otherRows.hide(); //Hide all rows apart from first row if adding new form
                $firstRow.find('.remove').hide(); //Hide the remove button from the first row 

			});
		}
	</script>

    <encounterLocation id="location_id" default="SessionAttribute:emrContext.sessionLocationId" class="hidden"/>
	<div>
		<div class="row">
			<div class="col-md-8">
				<H1>DS TB: HMIS TB 003 TB Client Card - Follow Up Section</H1>
			</div>
			<div class="col-md-3"></div>
			<div>
				<div class="col-md-1">
					<submit class="confirm" submitLabel="Save" submitStyle="customSubmit" />
				</div>
			</div>
		</div>
		<div class="row">
			<div class="col-md-12">
				<div class="card">
					<div class="card-header">
						<ul class="nav nav-tabs nav-fill card-header-tabs">
                            <li class="nav-item">
                                <a class="nav-link active" data-toggle="tab" href="#treatmeant-phase-section">Treatment Phase</a>
                            </li>
							<li class="nav-item">
								<a class="nav-link" data-toggle="tab" href="#lab-xray-investigation-section">Lab Tests/Other Investigations</a>
							</li>
                            <li class="nav-item">
                                <a class="nav-link" data-toggle="tab" href="#screening-management-section">Contact Screening and Management</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" data-toggle="tab" href="#transfer-section">Transfer</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" data-toggle="tab" href="#community-followup-section">Community follow up</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" data-toggle="tab" href="#dot-section">DOT</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" data-toggle="tab" href="#treatment-outcome-section">Treatment outcome</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" data-toggle="tab" href="#comment-section">Comments</a>
                            </li>
						</ul>
					</div>
					<div class="card-body">
						<div class="tab-content">
							<div class="tab-pane active" id="treatmeant-phase-section">
                                <div class="card">
                                    <div class="card-header">Visit Information</div>
                                    <div class="card-body">
                                        <div class="row">
                                            <div class="col-md-4 html-form-entry-disabled-field">
                                                <label>Encounter Date</label>
                                                <encounterDate default="today" disallowMultipleEncountersOnDate="block"/>
                                            </div>
                                            <div class="col-md-4">   
                                                <label>Next Date of Appointment</label>
                                                <obs id="5096" conceptId="5096" allowFutureDates="true"/>
                                            </div>
                                            <div class="col-md-4">
                                                <label>Month of Follow up</label>
                                                <obs conceptId="166773" answerConceptIds="166759,166760,166761,166762,166763,166764,166765,166766,166767,166768,166769,166770,166771,166772" answerLabels="1-2 Weeks,3-4 Weeks,5-6 Weeks,7-8 Weeks,Month 3,Month 4,Month 5,Month 6,Month 7,Month 8,Month 9,Month 10,Month 11,Month 12" required="required"/>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-6">
                                                <label>Provider</label>
                                                <encounterProviderAndRole encounterRole="240b26f9-dd88-4172-823d-4a8bfeb7841f" 
                                                                          required="required" default="currentUser"/>
                                            </div>
                                        </div>
                                    </div>
                                </div>
								<div class="card">
                                    <div class="card-header">Nutrition Assessment</div>
                                    <div class="card-body">
                                        <div class="row">
                                            <div class="col-md-4">
                                                <label>Weight (kg)</label>
                                                <obs conceptId="CIEL:5089" id="weight"/>
                                            </div>
                                            <div class="col-md-4">
                                                <label>Height (cm)</label>
                                                <obs conceptId="CIEL:5090" id="height"/>
                                            </div>
                                            <div class="col-md-4">
                                                <!-- only show BMI if patient is more than 5 years old (on the encounterDate) -->
                                                <includeIf
                                                        velocityTest="$patient.getAge($encounter.getEncounterDatetime()) > 5">
                                                    <label>BMI (Calculated)</label>
                                                    <span id="calculated-bmi-wrapper">
                                                        <ifMode mode="VIEW" include="false">
                                                            <span id='calculated-bmi'></span>
                                                        </ifMode>
                                                    </span>
                                                    <p id="calculated-bmi-continue">
                                                        <input type="hidden" name="focus-in-bmi-question"
                                                               id="hidden-calculated-bmi"/>
                                                    </p>

                                                </includeIf>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-4">
                                                <label>MUAC (Cm)</label>
                                                <obs conceptId="CIEL:1343" id="muac-score" />
                                            </div>
                                            <div class="col-md-4">
                                                <span class="muac">
                                                    <includeIf velocityTest="$patient.age &lt; 5">
                                                        <label>MUAC Code</label>
                                                        <obs id="muac-code" conceptId="99030" answerConceptIds="99028,99029,99027" answerLabels="Red &lt; 11.5cm, Yellow 11.5cm - &lt;12.5cm,Green &gt;= 12.5cm" />
                                                    </includeIf>
                                                    <includeIf velocityTest="$patient.age &lt; 10 &amp;&amp; $patient.age &gt;=5">
                                                        <label>MUAC Code</label>
                                                        <obs id="muac-code" conceptId="99030" answerConceptIds="99028,99029,99027" answerLabels="Red &lt; 13.5cm,Yellow 13.5cm - &lt;14.5cm,Green &gt;=14.5cm" />
                                                    </includeIf>
                                                    <includeIf velocityTest="$patient.age &lt; 18 &amp;&amp; $patient.age &gt;=10">
                                                        <label>MUAC Code</label>
                                                        <obs id="muac-code" conceptId="99030" answerConceptIds="99028,99029,99027" answerLabels="Red &lt; 16.5cm, Yellow 16.5cm - &lt;19.0cm,Green &gt;=19.0cm" />
                                                    </includeIf>
                                                    <includeIf velocityTest="$patient.age &gt;=18">
                                                        <label>MUAC Code</label>
                                                        <obs id="muac-code" conceptId="99030" answerConceptIds="99028,99029,99027" answerLabels="Red &lt;19.0cm , Yellow 19.0cm - &lt;22.0cm,Green &gt;=22.0cm" />
                                                    </includeIf>
                                                </span>
                                            </div>
                                            <excludeIf velocityTest="$patient.age &gt; 11">
                                                <div class="col-md-2">
                                                    <label>Z-Scores</label>
                                                    <obs conceptId="99800" answerConceptIds="99803,99804,99805,99806,99807" 
                                                         answerLabels="&#60;-3,-3_&#60;-1,-1_1,&#62;1_3,&#62;3" />
                                                </div>
                                            </excludeIf>
                                        </div>
                                    </div>
    							</div>
                                <div class="card">
                                    <div class="card-header">
                                        Drug Dispensed
                                    </div>
                                    <div class="card-body">
                                        <div class="row">
                                            <div class="col-md-4">
                                                <label>Treatment model</label>
                                                <obs conceptId="165869" answerConceptIds="165866,165867,165868" answerLabels="Facility DOTS,Digital Community DOTS,Non-Digital Community DOTS" class="long-value-select"/>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-3">
                                                <label>RHZE(150/75/400/275 mg) given</label>
                                                <obs conceptId="166780" answerConceptIds="90003,90004" 
                                                         answerLabels="Yes, No" style="radio" class="horizontal"/>
                                            </div>
                                            <div class="col-md-4">
                                                <label>RHZE(150/75/400/275 mg) blisters given</label>
                                                <obs conceptId="166781" class="long-value-select"/>
                                            </div>
                                            <div class="col-md-2">
                                                <label>RH (150/75mg) given</label>
                                                <obs conceptId="166782" answerConceptIds="90003,90004" 
                                                         answerLabels="Yes, No" style="radio" class="horizontal"/>
                                            </div>
                                            <div class="col-md-3">
                                                <label>RH (150/75mg) blisters given</label>
                                                <obs conceptId="166783" class="long-value-select"/>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-3">
                                                <label>RHZ (75/50/150mg) given</label>
                                                <obs conceptId="166784" answerConceptIds="90003,90004" 
                                                         answerLabels="Yes, No" style="radio" class="horizontal"/>
                                            </div>
                                            <div class="col-md-4">
                                                <label>RHZ (75/50/150mg) blisters given</label>
                                                <obs conceptId="166785" class="long-value-select"/>
                                            </div>
                                            <div class="col-md-2">
                                                <label>RH (75/50 mg) given</label>
                                                <obs conceptId="166786" answerConceptIds="90003,90004" 
                                                         answerLabels="Yes, No" style="radio" class="horizontal"/>
                                            </div>
                                            <div class="col-md-3">
                                                <label>RH (75/50 mg) blisters given</label>
                                                <obs conceptId="166787" class="long-value-select"/>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-3">
                                                <label>Ethambutol (100mg) given</label>
                                                <obs conceptId="166788" answerConceptIds="90003,90004" 
                                                         answerLabels="Yes, No" style="radio" class="horizontal"/>
                                            </div>
                                            <div class="col-md-4">
                                                <label>Ethambutol (100mg) blisters given</label>
                                                <obs conceptId="166789" class="long-value-select"/>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="card">
                                    <div class="card-header">
                                        HIV Information
                                    </div>
                                    <div class="card-body">
                                        <div class="row">
                                            <div class="col-md-3">
                                                <label>HIV status</label>
                                                <obs conceptId="165396" answerConceptIds="90167,165397,165350,90001"
                                                     answerLabels="Negative, Newly Tested Positive, Known Positive, Unknown" 
                                                     class="long-value-select" id="165396"/>
                                            </div>
                                            <div class="col-md-1"></div>
                                            <div class="col-md-2">
                                                <label>CPT/Dapson</label>
                                                <obs id="99413" conceptId="99413" answerConceptIds="1065,1066" class="horizontal" style="radio"/>
                                            </div>
                                            <div class="col-md-2">
                                                <label>ARV drugs</label>
                                                <obs id="165871" conceptId="165871" style="checkbox"/>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="card">
                                    <div class="card-header">
                                        Adverse Event
                                    </div>
                                    <div class="card-body">
                                        <div class="row">
                                            <div class="col-md-12">
                                                <label>Adverse event reported during the visit</label>
                                                <obs conceptId="166816" answerConceptIds="90003,90004" answerLabels="Yes,No" style="radio" class="horizontal"/>
                                            </div>
                                        </div>
                                        <repeat>
                                            <template>
                                                <obsgroup groupingConceptId="165305">
                                                    <span class="row add-remove-section">
                                                        <div class="col-md-3">
                                                            <label>Adverse event</label>
                                                            <obs id="side_effects_{n}" conceptId="90227" answerLabels="Deafness,Skin rash,Burning sensation in the feet,Joint pains,Mental confusion,Visual impairment,Hepatitis,Peripheral neuropathy,Flu syndrome,Low appetite, nausea, abdominal pain,Dermatitis,reddish-brown coloration of urine" class="long-value-select"/>  
                                                        </div>
                                                        <div class="col-md-3">
                                                            <label>Severity of adverse event</label>
                                                            <obs id="severity_{n}" conceptId="90250" answerConceptIds="90123,90124,90125,1368,90122" answerLabels="Mild,Moderate,Severe,Life threatening,No side effects" class="long-value-select"/>
                                                        </div>
                                                        <div class="col-md-3">
                                                            <label>Drug causing</label>
                                                            <obs id="drug_causing_{n}" conceptId="166836"/>
                                                        </div>
                                                        <div class="col-md-1">
                                                            <br/>
                                                            <a href="#" class="add add-more-link"><i class= "icon-plus-sign"></i></a>
                                                            <a href="#" class="remove remove-more-link required"><i class="icon-minus"></i></a>
                                                        </div>
                                                    </span>
                                                </obsgroup>
                                            </template>
                                            <render n="1"/>
                                            <render n="2"/>
                                            <render n="3"/>
                                            <render n="4"/>
                                            <render n="5"/>
                                            <render n="6"/>
                                            <render n="7"/>
                                        </repeat>
                                    </div>
                                </div>
							</div>

							<div class="tab-pane" role="tabpanel" aria-leballebdy="nav-profile-tab" id="lab-xray-investigation-section">
                                <div class="card">
                                    <div class="card-header">
                                        Laboratory Investigations
                                    </div>
                                    <div class="card-body">
                                        <div class="row">
                                            <div class="col-md-3">
                                                <label>Sample referred from community</label>
                                                <obs conceptId="166790" answerConceptIds="90003,90004" 
                                                         answerLabels="Yes,No" style="radio" class="horizontal"/>
                                            </div>
                                            <div class="col-md-6">
                                                <label>Name of facility/ Unit if sample is referred from outside the facility</label>
                                                <obs conceptId="166791" />
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-3">
                                                <label>Examination type</label>
                                                <obs conceptId="166792" />
                                            </div>
                                            <div class="col-md-4">
                                                <label>Month of follow up</label>
                                                <obs conceptId="166773" answerConceptIds="166759,166760,166761,166762,166763,166764,166765,166766,166767,166768,166769,166770,166771,166772" answerLabels="1-2 Weeks,3-4 Weeks,5-6 Weeks,7-8 Weeks,Month 3,Month 4,Month 5,Month 6,Month 7,Month 8,Month 9,Month 10,Month 11,Month 12" required="required"/>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="card">
                                    <div class="card-header">
                                        Test Results
                                    </div>
                                    <div class="card-body">
                                        <repeat>
                                            <template>
                                                <obsgroup groupingConceptId="99292">
                                                    <span class="row add-remove-section">
                                                        <div class="col-md-3">
                                                            <label>Date sample taken</label>
                                                            <obs conceptId="164431" allowTime="false" id="164431_{n}"/>
                                                        </div>
                                                        <div class="col-md-2">
                                                            <label>Test</label>
                                                            <obs conceptId="165844" answerConceptIds="90225,165413,165416,12,166839,166141,166828" 
                                                                 answerLabels="Smear, GeneXpert, LAM, X-ray, Culture, SL LPA, FL LPA" id="165844_{n}"/>
                                                        </div>
                                                        <div class="col-md-2 hidden" id="other-test-div_{n}">
                                                            <label>Other test</label>
                                                            <obs conceptId="99114" id="99114_{n}" />
                                                        </div>
                                                        <div class="col-md-2 hidden" id="other-results-div_{n}">
                                                            <label>Other results</label>
                                                            <obs conceptId="99291" id="99291_{n}" />
                                                        </div>
                                                        <div class="col-md-2" id="results-div_{n}">
                                                            <label>Results</label>
                                                            <obs conceptId="90225"  id="smear-results_{n}" class="hidden" />
                                                            <obs conceptId="162202" id="geneexper-results_{n}" class="long-value-select hidden" />
                                                            <obs conceptId="165291" id="tblam-results_{n}" class="hidden" />
                                                            <obs conceptId="12"     id="xray-results_{n}" class="hidden" />
                                                        </div>
                                                        <div class="col-md-2">
                                                            <label>Lab No.</label>
                                                            <obs conceptId="165845" id="165845_{n}" />
                                                        </div>
                                                        <div class="col-md-1">
                                                            <br/>
                                                            <a href="#" class="add add-more-link"><i class= "icon-plus-sign"></i></a>
                                                            <a href="#" class="remove remove-more-link required"><i class="icon-minus"></i></a>
                                                        </div>
                                                    </span>
                                                </obsgroup>
                                            </template>
                                            <render n="1"/>
                                            <render n="2"/>
                                            <render n="3"/>
                                            <render n="4"/>
                                            <render n="5"/>
                                        </repeat>
                                    </div>
                                </div>
							</div>

                            <div class="tab-pane" id="screening-management-section">
                                <div class="card">
                                    <div class="card-header">
                                        Contact Screening and Management
                                    </div>
                                    <div class="card-body">
                                        <div class="row">
                                            <div class="col-md-6">   
                                                <label>Date of report</label>
                                                <obs id="166793" conceptId="166793" allowFutureDates="false" required="required"/>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-6">
                                                <label>Total # of contacts  5 years</label>
                                                <obs conceptId="166794"/>
                                            </div>
                                            <div class="col-md-6">
                                                <label>Total # of contacts &lt; 5 years</label>
                                                <obs conceptId="164419"/>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-6">
                                                <label>Total # of  5 years old contacts screened for TB</label>
                                                <obs conceptId="166795"/>
                                            </div>
                                            <div class="col-md-6">
                                                <label>Total # of &lt; 5 years old contacts screened for TB</label>
                                                <obs conceptId="166796"/>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-6">
                                                <label>Total # of  5 years old contacts with TB</label>
                                                <obs conceptId="166798"/>
                                            </div>
                                            <div class="col-md-6">
                                                <label>Total # of &lt; 5 years old contacts with TB</label>
                                                <obs conceptId="166799"/>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-6">
                                                <label>Total # of  5 years old contacts on TPT</label>
                                                <obs conceptId="166800"/>
                                            </div>
                                            <div class="col-md-6">
                                                <label>Total # of &lt; 5 years old contacts on TPT</label>
                                                <obs conceptId="164421"/>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="tab-pane" id="transfer-section">
                                <div class="card">
                                    <div class="card">
                                        <div class="card-header">
                                            Transfer
                                        </div>
                                        <div class="card-body">
                                            <div class="row">
                                                <div class="col-md-3">
                                                    <label>Transfer date</label>
                                                    <obs conceptId="165854" allowTime="false"/>
                                                </div>
                                                <div class="col-md-3">
                                                    <label>Transfer type</label>
                                                    <obs conceptId="166837" id="166837" answerConceptIds="99110,90306" 
                                                         answerLabels="Transfer in, Transfer out" style="radio" class="horizontal"/>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-md-3">
                                                    <label>Transfer health facility</label>
                                                    <obs conceptId="166840" id="166840"/>
                                                </div>
                                                <div class="col-md-3">
                                                    <label>Transfer district</label>
                                                    <obs conceptId="166801" id="166801"/>
                                                </div>
                                                <div class="col-md-3">
                                                    <label>Phone No. of receiving health unit</label>
                                                    <obs conceptId="166802" id="166802"/>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="tab-pane" id="community-followup-section">
                                <div class="card">
                                    <div class="card-header">
                                        Follow up date
                                    </div>
                                    <div class="card-body">
                                        <div class="row">
                                            <div class="col-md-4">   
                                                <label>Date of follow up</label>
                                                <obs id="166803" conceptId="166803" allowFutureDates="true"/>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="card">
                                    <div class="card-header">
                                        Reasons for follow up
                                    </div>
                                    <div class="card-body">
                                        <div class="row">
                                            <div class="col-md-4">   
                                                <label>Patient missed appointment</label>
                                                <obs id="166817" conceptId="166817" answerConceptIds="90003,90004" 
                                                         answerLabels="Yes, No" style="radio" class="horizontal"/>
                                            </div>
                                            <div class="col-md-4">
                                                <label>Side effects (Patient active)</label>
                                                <obs id="166818" conceptId="166818" answerConceptIds="90003,90004" 
                                                         answerLabels="Yes, No" style="radio" class="horizontal"/>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="card">
                                    <div class="card-header">
                                        Mode of follow up
                                    </div>
                                    <div class="card-body">
                                        <div class="row">
                                            <div class="col-md-4">   
                                                <label>Physical visit</label>
                                                <!-- <obs id="165103" conceptId="165103" answerConceptIds="90003,90004" 
                                                         answerLabels="Yes, No" style="radio" class="horizontal"/> -->
                                            </div>
                                            <div class="col-md-4">
                                                <label>Phone call</label>
                                                <!-- <obs id="165102" conceptId="165102" answerConceptIds="90003,90004" 
                                                         answerLabels="Yes, No" style="radio" class="horizontal"/> -->
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="card">
                                    <div class="card-header">
                                        Support provided
                                    </div>
                                    <div class="card-body">
                                        <div class="row">
                                            <div class="col-md-4">   
                                                <label>DOT monitoring (Patient active)</label>
                                                <obs id="166819" conceptId="166819" answerConceptIds="90003,90004" 
                                                         answerLabels="Yes, No" style="radio" class="horizontal"/>
                                            </div>
                                            <div class="col-md-4">
                                                <label>Counselling</label>
                                                <obs id="99294" conceptId="99294" answerConceptIds="90003,90004" 
                                                         answerLabels="Yes, No" style="radio" class="horizontal"/>
                                            </div>
                                            <div class="col-md-4">   
                                                <label>Pill refill</label>
                                                <obs id="166820" conceptId="166820" answerConceptIds="90003,90004" 
                                                         answerLabels="Yes, No" style="radio" class="horizontal"/>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-4">
                                                <label>Appointment reminder</label>
                                                <obs id="166821" conceptId="166821" answerConceptIds="90003,90004" 
                                                         answerLabels="Yes, No" style="radio" class="horizontal"/>
                                            </div>
                                            <div class="col-md-4">   
                                                <label>Sputum sample collection</label>
                                                <obs id="166822" conceptId="166822" answerConceptIds="90003,90004" 
                                                         answerLabels="Yes, No" style="radio" class="horizontal"/>
                                            </div>
                                            <div class="col-md-4">
                                                <label>Other support</label>
                                                <obs id="166823" conceptId="166823" answerConceptIds="90003,90004" 
                                                         answerLabels="Yes, No" style="radio" class="horizontal"/>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="card">
                                    <div class="card-header">
                                        Outcome
                                    </div>
                                    <div class="card-body">
                                        <div class="row">
                                            <div class="col-md-4">   
                                                <label>Patient evaluated</label>
                                                <obs id="166825" conceptId="166825" answerConceptIds="90003,90004" 
                                                         answerLabels="Yes, No" style="radio" class="horizontal"/>
                                            </div>
                                            <div class="col-md-4">
                                                <label>Found with a treatment supporter</label>
                                                <obs id="166826" conceptId="166826" answerConceptIds="90003,90004" 
                                                         answerLabels="Yes, No" style="radio" class="horizontal"/>
                                            </div>
                                            <div class="col-md-4">   
                                                <label>Patient transfered out</label>
                                                <obs id="90306" conceptId="90306" answerConceptIds="90003,90004" 
                                                         answerLabels="Yes, No" style="radio" class="horizontal"/>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-4">
                                                <label>Outcome of follow up</label>
                                                <obs id="165104" conceptId="165104" answerConceptIds="165334,160034,165335,1363,165368" answerLabels="  Linked back into care,Died,Self transferred,Refused to return,Unreached"/>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="tab-pane" id="dot-section">
                                <div class="card">
                                    <div class="card-header">
                                        Appointment
                                    </div>
                                    <div class="card-body">
                                        <div class="row">
                                            <div class="col-md-6">   
                                                <label>Date of DOT report</label>
                                                <obs id="166842" conceptId="166842" allowFutureDates="true"/>
                                            </div>
                                            <div class="col-md-6">   
                                                <label>Next date of DOT appointment</label>
                                                <obs id="166804" conceptId="166804" allowFutureDates="true"/>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-6">
                                                <label>No. of days when patient was directly observed (in hospital or by DOT Nurse)</label>
                                                <obs id="166805" conceptId="166805"/>
                                            </div>
                                            <div class="col-md-6">
                                                <label>No. days of incomplete doses</label>
                                                <obs id="166806" conceptId="166806"/>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-6">
                                                <label>No. of days electronic message notifications of drug refills were received</label>
                                                <obs id="166807" conceptId="166807"/>
                                            </div>
                                            <div class="col-md-6">
                                                <label>No. of days of video observed therapy</label>
                                                <obs id="166808" conceptId="166808"/>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-6">
                                                <label>No. of days when DOT was not supervised</label>
                                                <obs id="166809" conceptId="166809"/>
                                            </div>
                                            <div class="col-md-6">
                                                <label>No. of days when doses were taken under observation of a treatment supporter</label>
                                                <obs id="166810" conceptId="166810"/>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-6">
                                                <label>No. of days when drugs were not taken</label>
                                                <obs id="166811" conceptId="166811"/>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="tab-pane" id="treatment-outcome-section">
                                <div class="card">
                                    <div class="card-header">
                                        Treatment Outcome
                                    </div>
                                    <div class="card-body">
                                        <div class="row">
                                            <div class="col-md-4">
                                                <label>Date of outcome</label>
                                                <obs conceptId="165872" allowTime="false" allowFutureDates="false"/>
                                            </div>
                                            <div class="col-md-4">
                                                <label>Outcome</label>
                                                <obs conceptId="99423" answerConceptIds="159791,99421,159874,5240,160737,160034" 
                                                     answerLabels="Cured, Treatment completed, Treatment failure, Lost to follow up, Not evaluated, Died" id="99423"/>
                                            </div>
                                            <div class="col-md-4">   
                                                <label>Transferred to 2nd line</label>
                                                <obs id="166812" conceptId="166812" answerConceptIds="90003,90004" 
                                                         answerLabels="Yes, No" style="radio" class="horizontal"/>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-4">   
                                                <label>Miss-classification</label>
                                                <obs id="166813" conceptId="166813" answerConceptIds="90003,90004" 
                                                         answerLabels="Yes, No" style="radio" class="horizontal"/>
                                            </div>
                                            <div class="col-md-4">
                                                <label>Reason for miss-classification</label>
                                                <obs id="166814" conceptId="166814" />
                                            </div>
                                            <div class="col-md-4">   
                                                <label>Action taken for miss-classification</label>
                                                <obs id="166815" conceptId="166815" />
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="tab-pane" id="comment-section">
                                <div class="card">
                                    <div class="card-header">
                                        Comments
                                    </div>
                                    <div class="card-body">
                                        <div class="row">
                                            <div class="col-md-12">
                                                <label>Doctor`s Reviews</label>
                                                <obs conceptId="165873" class="commenttextarea" style="textarea"/>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
    <postSubmissionAction class="org.openmrs.module.ugandaemr.htmlformentry.TBEncounterPageSubmissionAction"/>
</htmlform>